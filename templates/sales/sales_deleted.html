{% extends 'base.html' %}
{% block title %}Deleted Sales{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="h4 mb-0">Deleted Sales</h2>
  <a href="{% url 'sales_history' %}" class="btn btn-outline-secondary btn-sm">Back to history</a>
</div>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>Deleted at</th>
          <th>Sold at</th>
          <th>Product</th>
          <th class="text-end">Qty</th>
          <th class="text-end">Sale Price</th>
          <th class="text-end">Received</th>
          <th>Note</th>
          <th style="width:180px"></th>
        </tr>
      </thead>
      <tbody>
        {% for s in sales %}
        <tr>
          <td>{{ s.deleted_at|date:"Y-m-d H:i" }}</td>
          <td>{{ s.sold_at|date:"Y-m-d H:i" }}</td>
          <td>{{ s.product.name }}</td>
          <td class="text-end">{{ s.quantity }}</td>
          <td class="text-end">{{ s.price_at_sale|floatformat:2 }}</td>
          <td class="text-end">{{ s.actual_received|floatformat:2 }}</td>
          <td>{{ s.note|default:"" }}</td>
          <td>
            <div class="d-flex gap-1">
              {# ปุ่มกู้คืน #}
              <form method="post" action="{% url 'sale_restore' s.id %}">
                {% csrf_token %}
                <button class="btn btn-sm btn-success">Restore</button>
              </form>

              {# ปุ่มลบถาวร #}
              <form method="post" action="{% url 'sale_delete_permanent' s.id %}" onsubmit="return confirmPermanentDelete();">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-danger" title="Delete permanently">❌</button>
              </form>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="8" class="text-center text-secondary py-4">No deleted sales.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
function confirmPermanentDelete() {
  const txt = prompt("พิมพ์ PERMANENT เพื่อลบถาวร (กู้คืนไม่ได้)");
  if (!txt) return false;
  return txt.trim().toLowerCase() === "permanent";
}
</script>

{% endblock %}
